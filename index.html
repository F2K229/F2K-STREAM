<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F2K STREAM - Plateforme Musicale</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #7c3aed; --primary-dark: #5b21b6; --accent: #f59e0b;
  --green: #10b981; --danger: #ef4444;
  --bg: #0f0a1e; --bg2: #1a1033; --card: #1e1540; --card2: #251b4f;
  --border: rgba(124,58,237,0.25); --text: #e2d9f3; --text2: #9d8ec7;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'DM Sans',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; overflow-x:hidden; }
body::before { content:''; position:fixed; inset:0; background:radial-gradient(ellipse at 20% 20%,rgba(124,58,237,.12) 0%,transparent 55%),radial-gradient(ellipse at 80% 80%,rgba(245,158,11,.07) 0%,transparent 55%); pointer-events:none; z-index:0; }
.navbar { background:rgba(15,10,30,.97); backdrop-filter:blur(20px); padding:.9rem 2rem; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; position:fixed; width:100%; top:0; z-index:1000; flex-wrap:wrap; gap:.7rem; }
.logo { font-family:'Syne',sans-serif; font-size:1.6rem; font-weight:800; background:linear-gradient(135deg,#a78bfa,#f59e0b); -webkit-background-clip:text; -webkit-text-fill-color:transparent; cursor:pointer; }
.nav-links { display:flex; gap:1.1rem; align-items:center; flex-wrap:wrap; }
.nav-links a { text-decoration:none; color:var(--text2); font-weight:500; font-size:.88rem; cursor:pointer; transition:color .3s; }
.nav-links a:hover { color:#fff; }
.nav-btn { background:var(--primary)!important; color:#fff!important; padding:.42rem 1.1rem; border-radius:6px; font-weight:600!important; }
.nav-btn:hover { background:var(--primary-dark)!important; }
.admin-badge { background:var(--accent); color:#000; padding:.12rem .5rem; border-radius:20px; font-size:.68rem; font-weight:700; margin-left:.3rem; }
.container { max-width:1400px; margin:0 auto; padding:5.5rem 2rem 7rem; position:relative; z-index:1; }
.hero { text-align:center; padding:3.5rem 2rem 2.5rem; margin-bottom:2rem; }
.hero h1 { font-family:'Syne',sans-serif; font-size:clamp(2.5rem,6vw,5rem); font-weight:800; background:linear-gradient(135deg,#fff 0%,#c4b5fd 50%,#f59e0b 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; letter-spacing:-2px; line-height:1; margin-bottom:.8rem; }
.hero p { font-size:1.05rem; color:var(--text2); }
.tab-buttons { display:flex; gap:.4rem; margin-bottom:2rem; flex-wrap:wrap; justify-content:center; background:var(--card); padding:.4rem; border-radius:12px; border:1px solid var(--border); width:fit-content; margin-left:auto; margin-right:auto; }
.tab-button { padding:.55rem 1.3rem; border:none; border-radius:8px; background:transparent; color:var(--text2); cursor:pointer; font-weight:600; font-size:.88rem; transition:all .3s; font-family:'DM Sans',sans-serif; }
.tab-button:hover { color:#fff; background:rgba(124,58,237,.2); }
.tab-button.active { background:var(--primary); color:#fff; }
.tab-content { display:none; }
.tab-content.active { display:block; }
.section-title { font-family:'Syne',sans-serif; font-size:1.5rem; font-weight:700; color:#fff; margin-bottom:1.2rem; }
.songs-grid,.users-grid,.articles-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(270px,1fr)); gap:1.5rem; margin:1rem 0; }
.song-card { background:var(--card); border-radius:16px; overflow:hidden; border:1px solid var(--border); transition:transform .3s,box-shadow .3s; }
.song-card:hover { transform:translateY(-4px); box-shadow:0 16px 40px rgba(124,58,237,.2); }
.song-cover-wrapper { position:relative; height:190px; overflow:hidden; }
.song-cover { width:100%; height:100%; object-fit:cover; transition:transform .4s; }
.song-card:hover .song-cover { transform:scale(1.05); }
.song-cover-overlay { position:absolute; inset:0; background:linear-gradient(to top,rgba(15,10,30,.8) 0%,transparent 60%); }
.pending-badge { position:absolute; top:8px; right:8px; background:var(--accent); color:#000; font-size:.68rem; font-weight:700; padding:.2rem .5rem; border-radius:20px; }
.song-genre-badge { position:absolute; top:8px; left:8px; background:rgba(124,58,237,.85); color:#fff; font-size:.68rem; font-weight:600; padding:.2rem .5rem; border-radius:20px; }
.song-info { padding:1.1rem; }
.song-title { font-family:'Syne',sans-serif; font-size:.98rem; font-weight:700; color:#fff; margin-bottom:.25rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.song-artist { color:var(--text2); font-size:.83rem; margin-bottom:.2rem; }
.song-label { color:var(--accent); font-size:.76rem; margin-bottom:.7rem; font-weight:500; }
.song-stats { display:flex; gap:.8rem; color:var(--text2); font-size:.8rem; margin-bottom:.8rem; }
.stat-item { display:flex; align-items:center; gap:.25rem; }
.song-actions { display:flex; gap:.4rem; flex-wrap:wrap; }
.btn-play,.btn-download,.btn-share,.btn-delete,.btn-approve { padding:.5rem .7rem; border:none; border-radius:8px; cursor:pointer; font-weight:600; font-size:.78rem; transition:opacity .3s,transform .2s; display:flex; align-items:center; justify-content:center; gap:.25rem; font-family:'DM Sans',sans-serif; }
.btn-play { background:var(--primary); color:#fff; flex:2; }
.btn-download { background:var(--green); color:#fff; }
.btn-share { background:#0ea5e9; color:#fff; }
.btn-delete { background:var(--danger); color:#fff; }
.btn-approve { background:var(--green); color:#fff; flex:2; }
.btn-play:hover,.btn-download:hover,.btn-share:hover,.btn-delete:hover,.btn-approve:hover { opacity:.82; transform:scale(.97); }
.audio-player { position:fixed; bottom:0; left:0; right:0; background:rgba(15,10,30,.97); backdrop-filter:blur(20px); padding:.75rem 2rem; border-top:1px solid var(--border); display:none; z-index:1500; }
.audio-player.active { display:block; }
.player-controls { display:flex; align-items:center; gap:1.5rem; max-width:900px; margin:0 auto; flex-wrap:wrap; }
.now-playing { display:flex; align-items:center; gap:.8rem; flex:1; min-width:180px; }
.now-playing img { width:44px; height:44px; border-radius:8px; object-fit:cover; border:1px solid var(--border); }
.now-playing-title { font-weight:700; color:#fff; font-size:.88rem; }
.now-playing-artist { color:var(--text2); font-size:.76rem; }
.player-buttons { display:flex; gap:.7rem; }
.player-buttons button { background:none; border:none; font-size:1.3rem; cursor:pointer; color:var(--primary); transition:color .3s; }
.player-buttons button:hover { color:var(--accent); }
.progress-bar { flex:2; min-width:120px; height:4px; background:var(--card2); border-radius:2px; cursor:pointer; }
.progress-fill { height:100%; background:linear-gradient(90deg,var(--primary),var(--accent)); border-radius:2px; width:0%; transition:width .1s; }
.overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:1900; backdrop-filter:blur(4px); }
.overlay.active { display:block; }
.modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:var(--card); padding:2rem; border-radius:20px; border:1px solid var(--border); box-shadow:0 30px 60px rgba(0,0,0,.5); z-index:2000; width:90%; max-width:430px; max-height:90vh; overflow-y:auto; }
.modal.active { display:block; }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; }
.modal-header h2 { font-family:'Syne',sans-serif; font-size:1.2rem; color:#fff; }
.close-modal { cursor:pointer; font-size:1.5rem; color:var(--text2); background:none; border:none; line-height:1; }
.close-modal:hover { color:#fff; }
.form-group { margin-bottom:1rem; }
.form-group label { display:block; margin-bottom:.35rem; font-weight:500; font-size:.85rem; color:var(--text2); }
.form-group input,.form-group textarea,.form-group select { width:100%; padding:.72rem 1rem; background:var(--bg2); border:1px solid var(--border); border-radius:10px; font-size:.88rem; color:var(--text); font-family:'DM Sans',sans-serif; transition:border-color .3s; }
.form-group input:focus,.form-group textarea:focus,.form-group select:focus { outline:none; border-color:var(--primary); }
.form-group select option { background:var(--bg2); }
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
.btn { width:100%; padding:.88rem; background:var(--primary); color:#fff; border:none; border-radius:10px; font-size:.95rem; font-weight:600; cursor:pointer; transition:background .3s; font-family:'DM Sans',sans-serif; display:flex; align-items:center; justify-content:center; gap:.5rem; }
.btn:hover { background:var(--primary-dark); }
.btn:disabled { opacity:.5; cursor:not-allowed; }
.switch-auth { text-align:center; margin-top:1rem; color:var(--primary); cursor:pointer; font-size:.88rem; }
.file-input { border:2px dashed var(--border); padding:1.3rem; text-align:center; border-radius:10px; cursor:pointer; transition:border-color .3s,background .3s; background:var(--bg2); }
.file-input:hover { border-color:var(--primary); background:rgba(124,58,237,.05); }
.file-input i { font-size:1.8rem; color:var(--primary); margin-bottom:.4rem; display:block; }
.file-input p { color:var(--text2); font-size:.85rem; }
.file-input small { color:var(--text2); font-size:.75rem; }
.file-preview { display:none; margin-top:.7rem; }
.file-preview.active { display:block; }
.preview-image { max-width:130px; max-height:130px; border-radius:8px; margin-top:.4rem; border:2px solid var(--border); }
.dashboard-section { background:var(--card); border-radius:16px; padding:1.8rem; margin:1.2rem 0; border:1px solid var(--border); }
.dashboard-section h2 { font-family:'Syne',sans-serif; font-size:1.4rem; color:#fff; margin-bottom:1.5rem; }
.dashboard-section h3 { font-family:'Syne',sans-serif; font-size:1.05rem; color:var(--text); margin-bottom:1rem; padding-bottom:.5rem; border-bottom:1px solid var(--border); }
.upload-form { max-width:640px; margin:0 auto; }
.user-card { background:var(--card2); border-radius:12px; padding:1.1rem; border:1px solid var(--border); display:flex; flex-direction:column; gap:.7rem; }
.user-card-header { display:flex; align-items:center; gap:.75rem; }
.user-avatar { width:42px; height:42px; border-radius:50%; background:linear-gradient(135deg,var(--primary),var(--accent)); display:flex; align-items:center; justify-content:center; font-family:'Syne',sans-serif; font-weight:700; color:#fff; font-size:1rem; flex-shrink:0; }
.user-info { flex:1; min-width:0; }
.user-name { font-weight:700; color:#fff; font-size:.92rem; }
.user-email { color:var(--text2); font-size:.78rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.user-meta { color:var(--text2); font-size:.75rem; }
.role-badge { display:inline-block; padding:.12rem .5rem; border-radius:20px; font-size:.67rem; font-weight:700; }
.role-artist { background:rgba(124,58,237,.3); color:#c4b5fd; }
.role-producer { background:rgba(245,158,11,.3); color:#fcd34d; }
.role-admin { background:rgba(239,68,68,.3); color:#fca5a5; }
.user-status-pending { color:var(--accent); font-size:.76rem; font-weight:600; }
.user-status-confirmed { color:var(--green); font-size:.76rem; font-weight:600; }
.user-status-banned { color:var(--danger); font-size:.76rem; font-weight:600; }
.user-actions { display:flex; gap:.4rem; flex-wrap:wrap; }
.btn-sm { padding:.32rem .65rem; border:none; border-radius:6px; cursor:pointer; font-size:.72rem; font-weight:600; transition:opacity .3s; font-family:'DM Sans',sans-serif; }
.btn-sm:hover { opacity:.8; }
.btn-confirm { background:var(--green); color:#fff; }
.btn-ban { background:var(--danger); color:#fff; }
.btn-unban { background:var(--accent); color:#000; }
.btn-del-sm { background:rgba(239,68,68,.15); color:var(--danger); border:1px solid rgba(239,68,68,.3); }
.article-card { background:var(--card); border-radius:16px; overflow:hidden; border:1px solid var(--border); transition:transform .3s; }
.article-card:hover { transform:translateY(-3px); }
.article-image { width:100%; height:170px; object-fit:cover; }
.article-info { padding:1.1rem; }
.article-title { font-family:'Syne',sans-serif; font-size:.98rem; font-weight:700; color:#fff; margin-bottom:.35rem; }
.article-date { color:var(--text2); font-size:.78rem; margin-bottom:.7rem; }
.article-body { color:var(--text2); font-size:.83rem; line-height:1.5; }
.ranking-section { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:1.5rem; margin-top:1.2rem; }
.ranking-card { background:var(--card); border-radius:16px; padding:1.4rem; border:1px solid var(--border); }
.ranking-card h3 { font-family:'Syne',sans-serif; color:#fff; margin-bottom:1rem; font-size:.98rem; }
.ranking-item { display:flex; align-items:center; gap:.7rem; padding:.55rem 0; border-bottom:1px solid rgba(124,58,237,.1); }
.ranking-item:last-child { border-bottom:none; }
.ranking-num { width:22px; text-align:center; font-weight:700; color:var(--text2); font-size:.82rem; }
.ranking-info { flex:1; min-width:0; }
.ranking-title { font-weight:600; color:#fff; font-size:.85rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ranking-artist { color:var(--text2); font-size:.76rem; }
.ranking-val { color:var(--accent); font-weight:700; font-size:.82rem; }
.share-link-item { background:var(--bg2); padding:.9rem; border-radius:10px; margin-bottom:.7rem; border:1px solid var(--border); }
.share-link-item label { display:block; font-weight:600; margin-bottom:.4rem; font-size:.85rem; color:var(--text); }
.share-url { display:flex; gap:.4rem; }
.share-url input { flex:1; padding:.45rem .7rem; background:var(--card); border:1px solid var(--border); border-radius:6px; color:var(--text2); font-size:.78rem; }
.copy-btn { padding:.45rem .9rem; background:var(--primary); color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:.78rem; font-weight:600; }
.toast { position:fixed; top:76px; right:18px; padding:.85rem 1.4rem; border-radius:10px; color:#fff; z-index:3000; display:none; font-weight:500; font-size:.88rem; box-shadow:0 10px 30px rgba(0,0,0,.3); max-width:340px; }
.toast.success { background:var(--green); }
.toast.error { background:var(--danger); }
.toast.show { display:block; }
.loading { display:inline-block; width:16px; height:16px; border:2px solid rgba(255,255,255,.3); border-top:2px solid #fff; border-radius:50%; animation:spin .8s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }
.admin-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(130px,1fr)); gap:1rem; margin-bottom:2rem; }
.stat-card { background:var(--card2); border-radius:12px; padding:1.1rem; text-align:center; border:1px solid var(--border); }
.stat-card-num { font-family:'Syne',sans-serif; font-size:1.8rem; font-weight:800; color:var(--primary); }
.stat-card-label { color:var(--text2); font-size:.76rem; margin-top:.2rem; }
.search-bar { margin-bottom:1.1rem; }
.search-bar input { width:100%; padding:.72rem 1rem; background:var(--card); border:1px solid var(--border); border-radius:10px; color:var(--text); font-family:'DM Sans',sans-serif; font-size:.9rem; }
.search-bar input:focus { outline:none; border-color:var(--primary); }
.filter-tabs { display:flex; gap:.5rem; margin-bottom:1.2rem; flex-wrap:wrap; }
.filter-tab { padding:.35rem .9rem; background:var(--card); border:1px solid var(--border); border-radius:20px; color:var(--text2); cursor:pointer; font-size:.82rem; transition:all .3s; }
.filter-tab.active,.filter-tab:hover { background:var(--primary); color:#fff; border-color:var(--primary); }
.empty-state { text-align:center; padding:2.5rem; color:var(--text2); grid-column:1/-1; }
.empty-state i { font-size:2.5rem; margin-bottom:.8rem; color:var(--border); display:block; }
.footer { text-align:center; padding:2rem; color:var(--text2); margin-top:3rem; border-top:1px solid var(--border); font-size:.88rem; }
.footer p { margin:.35rem 0; }
.footer .brand { font-family:'Syne',sans-serif; font-weight:800; color:#fff; font-size:1.05rem; }
.footer .copyright { font-size:.78rem; opacity:.6; margin-top:.7rem; }
@media(max-width:768px) {
  .navbar { flex-direction:column; gap:.7rem; padding:.7rem 1rem; }
  .form-row { grid-template-columns:1fr; }
  .progress-bar { display:none; }
  .container { padding:6.5rem 1rem 7rem; }
}
</style>
</head>
<body>

<nav class="navbar">
  <div class="logo" onclick="window.location.reload()">F2K STREAM</div>
  <div class="nav-links">
    <a class="tab-trigger" data-tab="home">Accueil</a>
    <a class="tab-trigger" data-tab="rankings">Classements</a>
    <a class="tab-trigger" data-tab="articles">Actualit√©s</a>
    <a class="tab-trigger" data-tab="dashboard" id="dashboard-link" style="display:none">Espace Artiste</a>
    <a class="tab-trigger" data-tab="admin" id="admin-link" style="display:none">Admin</a>
    <a id="login-btn" class="nav-btn">Connexion</a>
    <a id="register-btn">Inscription</a>
    <a id="logout-btn" style="display:none">D√©connexion</a>
  </div>
</nav>

<div class="overlay" id="overlay"></div>
<div class="toast" id="toast"></div>

<div class="container">
  <div class="hero">
    <h1>F2K STREAM</h1>
    <p>La voix des artistes ind√©pendants ‚Äî √âcoute, d√©couvre, partage</p>
  </div>

  <div class="tab-buttons">
    <button class="tab-button active" data-tab="home">üéµ D√©couvrir</button>
    <button class="tab-button" data-tab="rankings">üèÜ Classements</button>
    <button class="tab-button" data-tab="articles">üì∞ Actualit√©s</button>
  </div>

  <!-- ACCUEIL -->
  <div class="tab-content active" id="tab-home">
    <div class="search-bar">
      <input type="text" id="search-input" placeholder="üîç Rechercher un son, artiste, label, genre...">
    </div>
    <div class="filter-tabs" id="genre-filters">
      <span class="filter-tab active" data-genre="">Tous</span>
      <span class="filter-tab" data-genre="Rap">Rap</span>
      <span class="filter-tab" data-genre="R&B">R&B</span>
      <span class="filter-tab" data-genre="Afrobeat">Afrobeat</span>
      <span class="filter-tab" data-genre="Coup√©-D√©cal√©">Coup√©-D√©cal√©</span>
      <span class="filter-tab" data-genre="Zouk">Zouk</span>
      <span class="filter-tab" data-genre="Gospel">Gospel</span>
      <span class="filter-tab" data-genre="Autre">Autre</span>
    </div>
    <p class="section-title">Derniers sons</p>
    <div class="songs-grid" id="songs-container">
      <div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>
    </div>
  </div>

  <!-- CLASSEMENTS -->
  <div class="tab-content" id="tab-rankings">
    <p class="section-title">üèÜ Classements</p>
    <div class="ranking-section">
      <div class="ranking-card"><h3>‚¨áÔ∏è Top t√©l√©chargements</h3><div id="top-downloads"></div></div>
      <div class="ranking-card"><h3>üëÅÔ∏è Top √©coutes</h3><div id="top-views"></div></div>
      <div class="ranking-card"><h3>‚ù§Ô∏è Top likes</h3><div id="top-likes"></div></div>
    </div>
  </div>

  <!-- ACTUALIT√âS -->
  <div class="tab-content" id="tab-articles">
    <p class="section-title">üì∞ Actualit√©s musicales</p>
    <div class="articles-grid" id="articles-container">
      <div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>
    </div>
  </div>

  <!-- ESPACE ARTISTE -->
  <div class="tab-content" id="tab-dashboard">
    <div class="dashboard-section">
      <h2>üé§ Espace Artiste / Producteur</h2>
      <form id="upload-form" class="upload-form">
        <h3>Publier un nouveau son</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Titre du morceau *</label>
            <input type="text" id="song-title" placeholder="Ex: Mon premier son" required>
          </div>
          <div class="form-group">
            <label>Nom d'artiste *</label>
            <input type="text" id="song-artist-name" placeholder="Ex: MC Kalif" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Nom du label</label>
            <input type="text" id="song-label" placeholder="Ex: Universal Music">
          </div>
          <div class="form-group">
            <label>Ann√©e de sortie *</label>
            <input type="number" id="song-year" placeholder="2025" min="1900" max="2099" required>
          </div>
        </div>
        <div class="form-group">
          <label>Featuring (artistes invit√©s)</label>
          <input type="text" id="song-featuring" placeholder="Ex: Artiste1, Artiste2 (optionnel)">
        </div>
        <div class="form-group">
          <label>Genre musical *</label>
          <select id="song-genre" required>
            <option value="">Choisis un genre</option>
            <option value="Rap">Rap</option>
            <option value="R&B">R&B</option>
            <option value="Afrobeat">Afrobeat</option>
            <option value="Coup√©-D√©cal√©">Coup√©-D√©cal√©</option>
            <option value="Zouk">Zouk</option>
            <option value="Gospel">Gospel</option>
            <option value="Autre">Autre</option>
          </select>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="song-description" rows="3" placeholder="Parle de ton son..."></textarea>
        </div>
        <div class="form-group">
          <label>Pochette (image) *</label>
          <div class="file-input" id="cover-dropzone">
            <i class="fas fa-image"></i>
            <p>Clique ou glisse ton image ici</p>
            <small>JPG, PNG ‚Äî Max 10 MB</small>
            <input type="file" id="cover-file" accept="image/*" style="display:none" required>
          </div>
          <div class="file-preview" id="cover-preview">
            <img src="" alt="Aper√ßu" class="preview-image">
          </div>
        </div>
        <div class="form-group">
          <label>Fichier audio (MP3) *</label>
          <div class="file-input" id="audio-dropzone">
            <i class="fas fa-music"></i>
            <p>Clique ou glisse ton MP3 ici</p>
            <small>MP3 ‚Äî Max 50 MB</small>
            <input type="file" id="audio-file" accept="audio/mpeg" style="display:none" required>
          </div>
          <div class="file-preview" id="audio-preview">
            <p style="color:var(--green);font-size:.85rem"><i class="fas fa-check-circle"></i> Fichier : <span id="audio-filename"></span></p>
          </div>
        </div>
        <button type="submit" class="btn" id="upload-btn">
          <span id="upload-btn-text">Publier mon son</span>
          <span class="loading" id="upload-loading" style="display:none"></span>
        </button>
        <p style="text-align:center;color:var(--text2);font-size:.78rem;margin-top:.8rem">
          <i class="fas fa-info-circle"></i> Ton son sera visible apr√®s validation par l'administrateur.
        </p>
      </form>
    </div>
    <div class="dashboard-section">
      <h3>Mes sons publi√©s</h3>
      <div class="songs-grid" id="my-songs-container">
        <div class="empty-state"><i class="fas fa-music"></i><p>Tu n'as pas encore publi√© de son.</p></div>
      </div>
    </div>
  </div>

  <!-- ESPACE ADMIN -->
  <div class="tab-content" id="tab-admin">
    <div class="dashboard-section">
      <h2>üëë Administration</h2>
      <div class="admin-stats">
        <div class="stat-card"><div class="stat-card-num" id="stat-users">-</div><div class="stat-card-label">Utilisateurs</div></div>
        <div class="stat-card"><div class="stat-card-num" id="stat-songs">-</div><div class="stat-card-label">Sons publi√©s</div></div>
        <div class="stat-card"><div class="stat-card-num" id="stat-pending">-</div><div class="stat-card-label">En attente</div></div>
        <div class="stat-card"><div class="stat-card-num" id="stat-articles">-</div><div class="stat-card-label">Articles</div></div>
      </div>
      <div style="margin-bottom:2.5rem">
        <h3>üéµ Publier un son directement</h3>
        <form id="admin-upload-form" style="margin-top:1rem">
          <div class="form-row">
            <div class="form-group"><label>Titre *</label><input type="text" id="admin-song-title" required></div>
            <div class="form-group"><label>Nom d'artiste *</label><input type="text" id="admin-song-artist-name" required></div>
          </div>
          <div class="form-row">
            <div class="form-group"><label>Nom du label</label><input type="text" id="admin-song-label"></div>
            <div class="form-group"><label>Ann√©e *</label><input type="number" id="admin-song-year" placeholder="2025" min="1900" max="2099" required></div>
          </div>
          <div class="form-row">
            <div class="form-group"><label>Featuring</label><input type="text" id="admin-song-featuring" placeholder="Optionnel"></div>
            <div class="form-group">
              <label>Genre *</label>
              <select id="admin-song-genre" required>
                <option value="">Choisir</option>
                <option value="Rap">Rap</option>
                <option value="R&B">R&B</option>
                <option value="Afrobeat">Afrobeat</option>
                <option value="Coup√©-D√©cal√©">Coup√©-D√©cal√©</option>
                <option value="Zouk">Zouk</option>
                <option value="Gospel">Gospel</option>
                <option value="Autre">Autre</option>
              </select>
            </div>
          </div>
          <div class="form-group"><label>Description</label><textarea id="admin-song-description" rows="2"></textarea></div>
          <div class="form-row">
            <div class="form-group">
              <label>Pochette *</label>
              <div class="file-input" id="admin-cover-dropzone">
                <i class="fas fa-image"></i><p>Image ici</p><small>JPG/PNG Max 10MB</small>
                <input type="file" id="admin-cover-file" accept="image/*" style="display:none" required>
              </div>
              <div class="file-preview" id="admin-cover-preview"><img src="" alt="" class="preview-image"></div>
            </div>
            <div class="form-group">
              <label>Fichier MP3 *</label>
              <div class="file-input" id="admin-audio-dropzone">
                <i class="fas fa-music"></i><p>MP3 ici</p><small>Max 50MB</small>
                <input type="file" id="admin-audio-file" accept="audio/mpeg" style="display:none" required>
              </div>
              <div class="file-preview" id="admin-audio-preview">
                <p style="color:var(--green);font-size:.82rem"><i class="fas fa-check-circle"></i> <span id="admin-audio-filename"></span></p>
              </div>
            </div>
          </div>
          <button type="submit" class="btn" id="admin-upload-btn">
            <span id="admin-upload-btn-text">Publier le son</span>
            <span class="loading" id="admin-upload-loading" style="display:none"></span>
          </button>
        </form>
      </div><!-- PUBLIER UN ARTICLE -->
      <div style="margin-bottom:2.5rem">
        <h3>üì∞ Publier un article</h3>
        <form id="article-form" style="max-width:600px;margin-top:1rem">
          <div class="form-group"><label>Titre *</label><input type="text" id="article-title" required></div>
          <div class="form-group"><label>Contenu *</label><textarea id="article-content" rows="5" required></textarea></div>
          <div class="form-group"><label>Image (optionnelle)</label><input type="file" id="article-image" accept="image/*" style="color:var(--text2)"></div>
          <button type="submit" class="btn" id="article-btn">
            <span id="article-btn-text">Publier l'article</span>
            <span class="loading" id="article-loading" style="display:none"></span>
          </button>
        </form>
      </div>

      <!-- SONS EN ATTENTE -->
      <div style="margin-bottom:2.5rem">
        <h3>‚è≥ Sons en attente de validation</h3>
        <div class="songs-grid" id="admin-pending-container">
          <div class="empty-state"><i class="fas fa-check-double"></i><p>Aucun son en attente.</p></div>
        </div>
      </div>

      <!-- GESTION UTILISATEURS -->
      <div style="margin-bottom:2.5rem">
        <h3>üë• Gestion des utilisateurs</h3>
        <div class="users-grid" id="admin-users-container">
          <div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>
        </div>
      </div>

      <!-- TOUS LES MORCEAUX -->
      <div style="margin-bottom:2.5rem">
        <h3>üéµ Tous les morceaux</h3>
        <div class="songs-grid" id="admin-songs-container">
          <div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>
        </div>
      </div>

      <!-- ARTICLES PUBLI√âS -->
      <div style="margin-bottom:2.5rem">
        <h3>üì∞ Articles publi√©s</h3>
        <div class="articles-grid" id="admin-articles-container">
          <div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- LECTEUR AUDIO -->
<div class="audio-player" id="audio-player">
  <div class="player-controls">
    <div class="now-playing">
      <img id="player-cover" src="" alt="Cover">
      <div>
        <div class="now-playing-title" id="player-title">-</div>
        <div class="now-playing-artist" id="player-artist">-</div>
      </div>
    </div>
    <div class="player-buttons">
      <button id="play-pause-btn"><i class="fas fa-play"></i></button>
      <button id="stop-btn"><i class="fas fa-stop"></i></button>
    </div>
    <div class="progress-bar" id="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    <audio id="audio-element"></audio>
  </div>
</div>

<!-- MODAL AUTH -->
<div class="modal" id="auth-modal">
  <div class="modal-header">
    <h2 id="auth-title">Connexion</h2>
    <button class="close-modal" id="close-modal">&times;</button>
  </div>
  <form id="login-form">
    <div class="form-group"><label>Email</label><input type="email" id="login-email" required></div>
    <div class="form-group"><label>Mot de passe</label><input type="password" id="login-password" required></div>
    <button type="submit" class="btn">Se connecter</button>
    <div class="switch-auth" id="switch-to-register">Pas encore de compte ? Inscris-toi !</div>
  </form>
  <form id="register-form" style="display:none">
    <div class="form-group"><label>Nom d'artiste / Producteur *</label><input type="text" id="register-name" required></div>
    <div class="form-row">
      <div class="form-group"><label>Email *</label><input type="email" id="register-email" required></div>
      <div class="form-group"><label>WhatsApp *</label><input type="tel" id="register-whatsapp" placeholder="+229 XX XX XX" required></div>
    </div>
    <div class="form-group">
      <label>Je suis *</label>
      <select id="register-role" required>
        <option value="artist">Artiste</option>
        <option value="producer">Producteur</option>
      </select>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Mot de passe *</label><input type="password" id="register-password" required></div>
      <div class="form-group"><label>Confirmer *</label><input type="password" id="register-confirm" required></div>
    </div>
    <button type="submit" class="btn">S'inscrire</button>
    <div class="switch-auth" id="switch-to-login">D√©j√† un compte ? Connecte-toi !</div>
  </form>
</div>

<!-- MODAL PARTAGE -->
<div class="modal" id="share-modal">
  <div class="modal-header">
    <h2>Partager ce morceau</h2>
    <button class="close-modal" id="close-share">&times;</button>
  </div>
  <div style="margin:1.1rem 0">
    <div class="share-link-item">
      <label>üîó Lien d'√©coute</label>
      <div class="share-url"><input type="text" id="listen-link" readonly><button class="copy-btn" onclick="copyLink('listen')">Copier</button></div>
    </div>
    <div class="share-link-item">
      <label>‚¨áÔ∏è Lien de t√©l√©chargement</label>
      <div class="share-url"><input type="text" id="download-link" readonly><button class="copy-btn" onclick="copyLink('download')">Copier</button></div>
    </div>
  </div>
  <p style="text-align:center;color:var(--text2);font-size:.82rem"><i class="fas fa-info-circle"></i> Ces liens peuvent √™tre partag√©s partout !</p>
</div>

<!-- FOOTER -->
<footer class="footer">
  <p class="brand">F2K STREAM</p>
  <p>La voix des artistes ind√©pendants</p>
  <p><i class="fas fa-phone"></i> +229 01 99 87 87 42 &nbsp;|&nbsp; <i class="fas fa-envelope"></i> f2kmultiservice@gmail.com</p>
  <p class="copyright">¬© 2025 F2K MULTISERVICE. Tous droits r√©serv√©s.</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs, where, updateDoc, doc, increment, getDoc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBTbU1ZNVCazGd08ItnVlfqQD99dL2XVqI",
  authDomain: "f2k-stream.firebaseapp.com",
  databaseURL: "https://f2k-stream-default-rtdb.firebaseio.com",
  projectId: "f2k-stream",
  storageBucket: "f2k-stream.firebasestorage.app",
  messagingSenderId: "452692882656",
  appId: "1:452692882656:web:675980ff4a20c40a4a0c85"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const ADMIN_EMAIL = "f2kmultiservice@gmail.com";

const overlay = document.getElementById('overlay');
const toast = document.getElementById('toast');
const authModal = document.getElementById('auth-modal');
const shareModal = document.getElementById('share-modal');
const loginForm = document.getElementById('login-form');
const registerForm = document.getElementById('register-form');
const loginBtn = document.getElementById('login-btn');
const registerBtn = document.getElementById('register-btn');
const logoutBtn = document.getElementById('logout-btn');
const dashboardLink = document.getElementById('dashboard-link');
const adminLink = document.getElementById('admin-link');
const uploadForm = document.getElementById('upload-form');
const adminUploadForm = document.getElementById('admin-upload-form');
const articleForm = document.getElementById('article-form');
const coverFile = document.getElementById('cover-file');
const audioFile = document.getElementById('audio-file');
const adminCoverFile = document.getElementById('admin-cover-file');
const adminAudioFile = document.getElementById('admin-audio-file');
const coverPreview = document.getElementById('cover-preview');
const audioPreview = document.getElementById('audio-preview');
const adminCoverPreview = document.getElementById('admin-cover-preview');
const adminAudioPreview = document.getElementById('admin-audio-preview');
const audioPlayer = document.getElementById('audio-player');
const audioElement = document.getElementById('audio-element');
const playPauseBtn = document.getElementById('play-pause-btn');
const stopBtn = document.getElementById('stop-btn');
const progressFill = document.getElementById('progress-fill');
const progressBar = document.getElementById('progress-bar');
const listenLink = document.getElementById('listen-link');
const downloadLink = document.getElementById('download-link');

let currentUser = null;
let isAdmin = false;
let allSongs = [];
let currentGenre = '';
let currentSearch = '';

function showToast(msg, type = 'success') {
  toast.textContent = msg;
  toast.className = `toast ${type} show`;
  setTimeout(() => toast.classList.remove('show'), 3500);
}

function openModal(m) { m.classList.add('active'); overlay.classList.add('active'); }
function closeAll() {
  authModal.classList.remove('active');
  shareModal.classList.remove('active');
  overlay.classList.remove('active');
}
overlay.addEventListener('click', closeAll);
document.getElementById('close-modal').addEventListener('click', closeAll);
document.getElementById('close-share').addEventListener('click', closeAll);

function showAuthModal(type) {
  openModal(authModal);
  if (type === 'register') {
    loginForm.style.display = 'none';
    registerForm.style.display = 'block';
    document.getElementById('auth-title').textContent = 'Inscription';
  } else {
    loginForm.style.display = 'block';
    registerForm.style.display = 'none';
    document.getElementById('auth-title').textContent = 'Connexion';
  }
}window.copyLink = function(type) {
  const el = type === 'listen' ? listenLink : downloadLink;
  el.select(); document.execCommand('copy');
  showToast('Lien copi√© !');
};

const tabButtons = document.querySelectorAll('.tab-button');
const tabContents = document.querySelectorAll('.tab-content');
const tabTriggers = document.querySelectorAll('.tab-trigger');

window.showTab = function(tabId) {
  tabButtons.forEach(b => b.classList.remove('active'));
  tabContents.forEach(c => { c.classList.remove('active'); c.style.display = 'none'; });
  const btn = Array.from(tabButtons).find(b => b.dataset.tab === tabId);
  if (btn) btn.classList.add('active');
  const target = document.getElementById('tab-' + tabId);
  if (!target) return;
  target.classList.add('active');
  target.style.display = 'block';
  if (tabId === 'admin' && isAdmin) loadAdminAll();
  else if (tabId === 'articles') loadArticles();
  else if (tabId === 'dashboard' && currentUser) loadMySongs();
  else if (tabId === 'rankings') loadRankings();
};

tabButtons.forEach(b => b.addEventListener('click', () => window.showTab(b.dataset.tab)));
tabTriggers.forEach(t => t.addEventListener('click', e => {
  e.preventDefault();
  const tabId = t.dataset.tab;
  if (tabId === 'dashboard' && !currentUser) { showAuthModal('login'); return; }
  if (tabId === 'admin' && !isAdmin) { showToast("Acc√®s r√©serv√© √† l'administrateur", 'error'); return; }
  window.showTab(tabId);
}));

document.getElementById('search-input').addEventListener('input', e => {
  currentSearch = e.target.value.toLowerCase();
  renderSongs();
});
document.getElementById('genre-filters').addEventListener('click', e => {
  const tab = e.target.closest('.filter-tab');
  if (!tab) return;
  document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
  tab.classList.add('active');
  currentGenre = tab.dataset.genre;
  renderSongs();
});

function renderSongs() {
  const container = document.getElementById('songs-container');
  let list = allSongs.filter(s => s.approved === true);
  if (currentGenre) list = list.filter(s => s.genre === currentGenre);
  if (currentSearch) list = list.filter(s =>
    (s.title||'').toLowerCase().includes(currentSearch) ||
    (s.artistName||'').toLowerCase().includes(currentSearch) ||
    (s.label||'').toLowerCase().includes(currentSearch) ||
    (s.featuring||'').toLowerCase().includes(currentSearch) ||
    (s.genre||'').toLowerCase().includes(currentSearch)
  );
  container.innerHTML = '';
  if (!list.length) {
    container.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><p>Aucun son trouv√©.</p></div>';
    return;
  }
  list.forEach(song => container.appendChild(buildSongCard(song, false, false)));
}

const CLOUDINARY_CLOUD = 'di4byrrfv';
const CLOUDINARY_PRESET = 'f2k_stream';

async function uploadToCatbox(file) {
  const isAudio = file.type.includes('audio') || file.name.endsWith('.mp3');
  const resourceType = isAudio ? 'video' : 'image';
  const url = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD}/${resourceType}/upload`;
  const fd = new FormData();
  fd.append('file', file);
  fd.append('upload_preset', CLOUDINARY_PRESET);
  const res = await fetch(url, { method: 'POST', body: fd });
  if (!res.ok) {
    const err = await res.json();
    throw new Error(err.error?.message || 'Erreur upload Cloudinary');
  }
  const data = await res.json();
  return data.secure_url;
}

loginBtn.addEventListener('click', () => showAuthModal('login'));
registerBtn.addEventListener('click', () => showAuthModal('register'));
logoutBtn.addEventListener('click', async () => { await signOut(auth); showToast('D√©connexion r√©ussie'); });
document.getElementById('switch-to-register').addEventListener('click', () => showAuthModal('register'));
document.getElementById('switch-to-login').addEventListener('click', () => showAuthModal('login'));

registerForm.addEventListener('submit', async e => {
  e.preventDefault();
  const name = document.getElementById('register-name').value;
  const email = document.getElementById('register-email').value;
  const whatsapp = document.getElementById('register-whatsapp').value;
  const role = document.getElementById('register-role').value;
  const password = document.getElementById('register-password').value;
  const confirm = document.getElementById('register-confirm').value;
  if (password !== confirm) { showToast('Les mots de passe ne correspondent pas', 'error'); return; }
  try {
    const cred = await createUserWithEmailAndPassword(auth, email, password);
    const isUserAdmin = email === ADMIN_EMAIL;
    await setDoc(doc(db, 'users', cred.user.uid), {
      name, email, whatsapp,
      role: isUserAdmin ? 'admin' : role,
      isConfirmed: isUserAdmin,
      isBanned: false,
      createdAt: new Date().toISOString()
    });
    closeAll();
    showToast(isUserAdmin ? 'Bienvenue Administrateur !' : 'Inscription r√©ussie ! En attente de confirmation.');
  } catch (err) { showToast(err.message, 'error'); }
});

loginForm.addEventListener('submit', async e => {
  e.preventDefault();
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  try {
    const cred = await signInWithEmailAndPassword(auth, email, password);
    const uDoc = await getDoc(doc(db, 'users', cred.user.uid));
    if (uDoc.exists() && uDoc.data().isBanned) {
      await signOut(auth);
      showToast("Votre compte a √©t√© banni. Contactez l'administrateur.", 'error');
      return;
    }
    closeAll();
    showToast('Connexion r√©ussie !');
  } catch (err) { showToast('Email ou mot de passe incorrect', 'error'); }
});

onAuthStateChanged(auth, async user => {
  if (user) {
    currentUser = user;
    const uDoc = await getDoc(doc(db, 'users', user.uid));
    if (uDoc.exists()) {
      currentUser = { ...user, ...uDoc.data() };
      isAdmin = user.email === ADMIN_EMAIL || uDoc.data().role === 'admin';
    } else if (user.email === ADMIN_EMAIL) {
      await setDoc(doc(db, 'users', user.uid), {
        name:'Administrateur', email:user.email, role:'admin',
        isConfirmed:true, isBanned:false, createdAt:new Date().toISOString()
      });
      isAdmin = true;
      currentUser = { ...user, name:'Administrateur', role:'admin' };
    }
    loginBtn.style.display = 'none';
    registerBtn.style.display = 'none';
    logoutBtn.style.display = 'inline';
    dashboardLink.style.display = 'inline';
    if (isAdmin) {
      adminLink.style.display = 'inline';
      dashboardLink.innerHTML = 'Espace Artiste <span class="admin-badge">Admin</span>';
    } else {
      adminLink.style.display = 'none';
      dashboardLink.innerHTML = 'Espace Artiste';
    }
  } else {
    currentUser = null; isAdmin = false;
    loginBtn.style.display = 'inline'; registerBtn.style.display = 'inline';
    logoutBtn.style.display = 'none';
    dashboardLink.style.display = 'none'; adminLink.style.display = 'none';
  }
  loadSongs(); loadRankings(); loadArticles();
  window.showTab('home');
});

function setupDropzone(dzId, inputEl, previewEl, isImg, fnSpanId) {
  const dz = document.getElementById(dzId);
  dz.addEventListener('click', () => inputEl.click());
  dz.addEventListener('dragover', e => { e.preventDefault(); dz.style.borderColor = 'var(--primary)'; });
  dz.addEventListener('dragleave', () => { dz.style.borderColor = ''; });
  dz.addEventListener('drop', e => {
    e.preventDefault(); dz.style.borderColor = '';
    const f = e.dataTransfer.files[0];
    if (f) { inputEl.files = e.dataTransfer.files; handlePreview(f, previewEl, isImg, fnSpanId); }
  });
  inputEl.addEventListener('change', e => {
    if (e.target.files[0]) handlePreview(e.target.files[0], previewEl, isImg, fnSpanId);
  });
}
function handlePreview(file, previewEl, isImg, fnSpanId) {
  previewEl.classList.add('active');
  if (isImg) {
    const r = new FileReader();
    r.onload = e => previewEl.querySelector('img').src = e.target.result;
    r.readAsDataURL(file);
  } else if (fnSpanId) {
    document.getElementById(fnSpanId).textContent = file.name;
  }
}
setupDropzone('cover-dropzone', coverFile, coverPreview, true, null);
setupDropzone('audio-dropzone', audioFile, audioPreview, false, 'audio-filename');
setupDropzone('admin-cover-dropzone', adminCoverFile, adminCoverPreview, true, null);
setupDropzone('admin-audio-dropzone', adminAudioFile, adminAudioPreview, false, 'admin-audio-filename');async function loadArticles() {
  const c = document.getElementById('articles-container');
  try {
    const snap = await getDocs(query(collection(db,'articles'), orderBy('createdAt','desc'), limit(12)));
    c.innerHTML = '';
    if (snap.empty) {
      c.innerHTML = '<div class="empty-state"><i class="fas fa-newspaper"></i><p>Aucun article pour le moment.</p></div>';
      return;
    }
    snap.docs.forEach(d => c.appendChild(buildArticleCard({ id:d.id, ...d.data() }, false)));
  } catch (err) { console.error(err); }
}

function buildArticleCard(article, isAdminView) {
  const card = document.createElement('div');
  card.className = 'article-card';
  const date = new Date(article.createdAt).toLocaleDateString('fr-FR');
  card.innerHTML = `
    ${article.imageUrl ? `<img src="${article.imageUrl}" alt="${escHtml(article.title)}" class="article-image">` : ''}
    <div class="article-info">
      <div class="article-title">${escHtml(article.title)}</div>
      <div class="article-date">${date} ¬∑ Par ${escHtml(article.authorName)}</div>
      <div class="article-body">${escHtml(article.content.substring(0,180))}${article.content.length>180?'...':''}</div>
      ${isAdminView ? `<div style="margin-top:.8rem"><button class="btn-sm btn-del-sm" onclick="deleteArticle('${article.id}')"><i class="fas fa-trash"></i> Supprimer</button></div>` : ''}
    </div>`;
  return card;
}

window.deleteArticle = async function(id) {
  if (!confirm('Supprimer cet article ?')) return;
  try {
    await deleteDoc(doc(db,'articles',id));
    showToast('Article supprim√©.');
    loadArticles(); loadAdminAll();
  } catch { showToast('Erreur.', 'error'); }
};

async function loadRankings() {
  try {
    const [dS,vS,lS] = await Promise.all([
      getDocs(query(collection(db,'songs'), where('approved','==',true), orderBy('downloads','desc'), limit(5))),
      getDocs(query(collection(db,'songs'), where('approved','==',true), orderBy('views','desc'), limit(5))),
      getDocs(query(collection(db,'songs'), where('approved','==',true), orderBy('likes','desc'), limit(5)))
    ]);
    function render(cId, snap, field, icon) {
      const el = document.getElementById(cId);
      el.innerHTML = '';
      if (snap.empty) { el.innerHTML = '<p style="color:var(--text2);font-size:.82rem">Aucune donn√©e.</p>'; return; }
      snap.docs.forEach((d,i) => {
        const s = d.data();
        el.innerHTML += `
          <div class="ranking-item">
            <div class="ranking-num">${i+1}</div>
            <div class="ranking-info">
              <div class="ranking-title">${escHtml(s.title)}</div>
              <div class="ranking-artist">${escHtml(s.artistName||s.uploadedBy)}</div>
            </div>
            <div class="ranking-val">${icon} ${s[field]||0}</div>
          </div>`;
      });
    }
    render('top-downloads', dS, 'downloads', '‚¨áÔ∏è');
    render('top-views', vS, 'views', 'üëÅÔ∏è');
    render('top-likes', lS, 'likes', '‚ù§Ô∏è');
  } catch (err) { console.error('Rankings:', err); }
}

async function loadAdminAll() {
  if (!isAdmin) return;
  await Promise.all([
    updateAdminStats(),
    loadAdminPending(),
    loadAdminUsers(),
    loadAdminSongs(),
    loadAdminArticles()
  ]);
}

async function updateAdminStats() {
  try {
    const [u,s,p,a] = await Promise.all([
      getDocs(collection(db,'users')),
      getDocs(collection(db,'songs')),
      getDocs(query(collection(db,'songs'), where('approved','==',false))),
      getDocs(collection(db,'articles'))
    ]);
    document.getElementById('stat-users').textContent    = u.size;
    document.getElementById('stat-songs').textContent    = s.size;
    document.getElementById('stat-pending').textContent  = p.size;
    document.getElementById('stat-articles').textContent = a.size;
  } catch (err) { console.error(err); }
}

async function loadAdminPending() {
  const c = document.getElementById('admin-pending-container');
  c.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>';
  try {
    const snap = await getDocs(query(collection(db,'songs'), where('approved','==',false), orderBy('createdAt','desc')));
    c.innerHTML = '';
    if (snap.empty) {
      c.innerHTML = '<div class="empty-state"><i class="fas fa-check-double"></i><p>Aucun son en attente.</p></div>';
      return;
    }
    snap.docs.forEach(d => c.appendChild(buildSongCard({ id:d.id, ...d.data() }, false, true)));
  } catch (err) { console.error(err); }
}

async function loadAdminUsers() {
  const c = document.getElementById('admin-users-container');
  c.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>';
  try {
    const snap = await getDocs(query(collection(db,'users'), orderBy('createdAt','desc')));
    c.innerHTML = '';
    if (snap.empty) {
      c.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><p>Aucun utilisateur.</p></div>';
      return;
    }
    snap.docs.forEach(d => c.appendChild(buildUserCard({ id:d.id, ...d.data() })));
  } catch (err) {
    console.error(err);
    document.getElementById('admin-users-container').innerHTML =
      '<div class="empty-state"><i class="fas fa-exclamation-circle"></i><p>Erreur chargement utilisateurs.</p></div>';
  }
}

function buildUserCard(user) {
  const card = document.createElement('div');
  card.className = 'user-card';
  const initial = (user.name||user.email||'?')[0].toUpperCase();
  const roleClass = user.role === 'admin' ? 'role-admin' : user.role === 'producer' ? 'role-producer' : 'role-artist';
  const roleName  = user.role === 'admin' ? 'Admin' : user.role === 'producer' ? 'Producteur' : 'Artiste';
  const status = user.isBanned
    ? '<span class="user-status-banned">üö´ Banni</span>'
    : user.isConfirmed
      ? '<span class="user-status-confirmed">‚úÖ Confirm√©</span>'
      : '<span class="user-status-pending">‚è≥ En attente</span>';
  const date = user.createdAt ? new Date(user.createdAt).toLocaleDateString('fr-FR') : '';
  const uid = user.id;
  card.innerHTML = `
    <div class="user-card-header">
      <div class="user-avatar">${initial}</div>
      <div class="user-info">
        <div class="user-name">${escHtml(user.name||'Sans nom')} <span class="role-badge ${roleClass}">${roleName}</span></div>
        <div class="user-email">${escHtml(user.email)}</div>
        ${user.whatsapp ? `<div class="user-meta">üì± ${escHtml(user.whatsapp)}</div>` : ''}
      </div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;font-size:.78rem">
      ${status}
      <span style="color:var(--text2)">Inscrit le ${date}</span>
    </div>
    <div class="user-actions">
      ${!user.isConfirmed && !user.isBanned && user.role !== 'admin'
        ? `<button class="btn-sm btn-confirm" onclick="confirmUser('${uid}')"><i class="fas fa-check"></i> Confirmer</button>` : ''}
      ${!user.isBanned && user.role !== 'admin'
        ? `<button class="btn-sm btn-ban" onclick="banUser('${uid}')"><i class="fas fa-ban"></i> Bannir</button>`
        : user.isBanned
          ? `<button class="btn-sm btn-unban" onclick="unbanUser('${uid}')"><i class="fas fa-undo"></i> R√©activer</button>` : ''}
      ${user.role !== 'admin'
        ? `<button class="btn-sm btn-del-sm" onclick="deleteUser('${uid}')"><i class="fas fa-trash"></i> Supprimer</button>` : ''}
    </div>`;
  return card;
}

window.confirmUser = async function(uid) {
  if (!confirm('Confirmer ce compte ?')) return;
  try { await updateDoc(doc(db,'users',uid), { isConfirmed:true }); showToast('Compte confirm√© !'); loadAdminUsers(); }
  catch { showToast('Erreur.', 'error'); }
};
window.banUser = async function(uid) {
  if (!confirm('Bannir cet utilisateur ?')) return;
  try { await updateDoc(doc(db,'users',uid), { isBanned:true }); showToast('Utilisateur banni.'); loadAdminUsers(); }
  catch { showToast('Erreur.', 'error'); }
};
window.unbanUser = async function(uid) {
  if (!confirm('R√©activer ce compte ?')) return;
  try { await updateDoc(doc(db,'users',uid), { isBanned:false, isConfirmed:true }); showToast('Compte r√©activ√© !'); loadAdminUsers(); }
  catch { showToast('Erreur.', 'error'); }
};
window.deleteUser = async function(uid) {
  if (!confirm('Supprimer d√©finitivement ce compte ? Action irr√©versible.')) return;
  try { await deleteDoc(doc(db,'users',uid)); showToast('Compte supprim√©.'); loadAdminUsers(); updateAdminStats(); }
  catch { showToast('Erreur.', 'error'); }
};

async function loadAdminSongs() {
  const c = document.getElementById('admin-songs-container');
  c.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>';
  try {
    const snap = await getDocs(query(collection(db,'songs'), orderBy('createdAt','desc')));
    c.innerHTML = '';
    if (snap.empty) {
      c.innerHTML = '<div class="empty-state"><i class="fas fa-music"></i><p>Aucun morceau.</p></div>';
      return;
    }
    snap.docs.forEach(d => c.appendChild(buildSongCard({ id:d.id, ...d.data() }, true, false)));
  } catch (err) { console.error(err); }
}

async function loadAdminArticles() {
  const c = document.getElementById('admin-articles-container');
  c.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Chargement...</p></div>';
  try {
    const snap = await getDocs(query(collection(db,'articles'), orderBy('createdAt','desc')));
    c.innerHTML = '';
    if (snap.empty) {
      c.innerHTML = '<div class="empty-state"><i class="fas fa-newspaper"></i><p>Aucun article.</p></div>';
      return;
    }
    snap.docs.forEach(d => c.appendChild(buildArticleCard({ id:d.id, ...d.data() }, true)));
  } catch (err) { console.error(err); }
}

(function() {
  const pid = new URLSearchParams(window.location.search).get('play');
  if (pid) setTimeout(() => window.playSong(pid), 2500);
})();

console.log('‚úÖ F2K STREAM charg√© avec succ√®s !');
</script>
</body>
</html>
